pipeline {
    agent any
    environment {
        registry = credentials('docker_hub_registry')
        registryCredential = credentials('docker_hub')
    }
    stages {
        stage('Build Docker Image') {
            steps {
                bat 'docker build -t %registry%:%BUILD_NUMBER% .'
            }
        }
        stage('Clean environment') {
            steps {
                bat 'python clean_environment.py'
            }
        }
    }
        post{
         always{
         bat "docker rmi %registry%:%BUILD_NUMBER%"
         }
     }
}
