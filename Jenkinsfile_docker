pipeline {
    agent any
    environment {
        registry = credentials('docker_hub_registry')
        registryCredential = credentials('docker_hub')
    }
    stages {
        stage('Build Docker Image') {
            steps {
                bat 'docker build -t %registry%:%BUILD_NUMBER% .'
            }
        }
		stage('Push Docker Image to Hub') {
            steps {
                bat 'docker %BUILD_NUMBER% %registry% %registry%'
		bat 'docker push %registry%'
            }
        }
        stage('Clean environment') {
            steps {
                bat 'python clean_environment.py'
            }
        }
    }

}
